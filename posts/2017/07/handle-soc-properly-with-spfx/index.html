<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>YPcode</title>
    <link rel="icon" href="/images/favicon.png" type="image/png" />
    <link rel="canonical" href="https://ypcode.github.io/posts/2017/07/handle-soc-properly-with-spfx" />
    <link rel="stylesheet" href="/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="/css/site.css" />
    <meta name="generator" content="PVX WebContentGenerator" />
   
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/themes/prism.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/themes/prism.min.css">
</noscript>
<link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/themes/prism-tomorrow.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/themes/prism-tomorrow.min.css">
</noscript>
<link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/plugins/autolinker/prism-autolinker.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/plugins/autolinker/prism-autolinker.css">
</noscript>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-172372458-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-172372458-1');
</script>

<style>
.social-links {
    display: inline-flex;
    width: 60%;
    margin:auto;
    justify-content: center;
    color: #807070;
}

.social-links a {
    margin-right: 15px;
}

.social-links a:hover {
    color: #9e1e28;
}

    .social-links svg {
        fill: currentColor;
        height: 18px;
    }
</style>
        <meta property="og:site_name" content="YPcode" />
        <meta property="og:type" content="article" />
        <meta property="og:title" content="Handle separation of concerns (SoC) properly with the SharePoint Framework" />
        <meta property="og:url" content="https://ypcode.github.io/posts/2017/07/handle-soc-properly-with-spfx" />
        <meta property="og:image" content="https://ypcode.github.io/images/code.jpg" />
        <meta property="article:publisher" content="https://www.facebook.com/yannick.plenevaux" />
        <meta property="article:published_time" content="2017-07-28 17:02:36Z" />
        <meta property="article:modified_time" content="2017-07-28 17:02:36Z" />
                <meta property="article:tag" content="JavaScript" />
                <meta property="article:tag" content="SharePoint" />
                <meta property="article:tag" content="SharePoint Framework" />
                <meta property="article:tag" content="SharePoint Online" />
                <meta property="article:tag" content="SPFx" />
                <meta property="article:tag" content="TypeScript" />
        <meta name="twitter:title" content="Handle separation of concerns (SoC) properly with the SharePoint Framework" />
        <meta name="twitter:url" content="https://ypcode.github.io/posts/2017/07/handle-soc-properly-with-spfx" />
            <meta name="twitter:card" content="summary_large_image" />
            <meta name="twitter:image" content="https://ypcode.github.io/images/code.jpg" />
            <meta name="twitter:label2" content="Filed under" />
            <meta name="twitter:data2" content="JavaScript, SharePoint, SharePoint Framework, SharePoint Online, SPFx, TypeScript" />
        <meta name="twitter:site" content="@yp_code" />
    <link rel="alternate" type="application/rss+xml" title="YPcode" href="https://ypcode.github.io/feed" />


    <script>
        var initialSiteContentHeight = null;
        function toggleMenu() {
            var menu = document.querySelector(".menu");
            var siteContent = document.querySelector(".site-content");
            if (menu && siteContent) {
                if (menu.classList.contains("visible")) {
                    menu.classList.remove("visible");
                } else {
                    menu.classList.add("visible");
                }
            }
        }
    </script>
</head>
<body>
    <div class="menu">
        <span class="menu-hamburger-icon" onclick="toggleMenu();">
            <svg xmlns="http://www.w3.org/2000/svg" 
                x="0px" 
                y="0px"
                width="30" 
                height="30"
                viewBox="0 0 172 172"
                style=" fill:#000000;">
                    <g fill="none" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal"><path d="M0,172v-172h172v172z" fill="none"></path><g fill="#ffffff"><path d="M0,25.8v17.2h172v-17.2zM0,77.4v17.2h172v-17.2zM0,129v17.2h172v-17.2z"></path></g></g>
            </svg>
        </span>
        <a href="https://ypcode.github.io/">
            <h1 class="main-site-title">YPcode</h1>
            <hr class="sep main-site-title-sep"/>
            <h2 class="main-site-description">Experiences and research on Microsoft 365, Azure and modern web development</h2>
        </a>
        <nav class="navigation">
    <ul>
<li class="nav-item">
    <span class="link-icon icon-home" ></span><a class="nav-link" href="/" >Home</a>
</li><li class="nav-item">
    <span class="link-icon icon-about" ></span><a class="nav-link" href="/pages/about-me/" >About me</a>
</li><li class="nav-item">
    <span class="link-icon icon-about" ></span><a class="nav-link" href="/pages/projects-contrib/" >Projects &amp; Contributions</a>
</li>    </ul>
</nav>
        
            <div class="main-site-author">
                    <img class="main-site-author-picture" src="/images/me.png" />
                    <h3 class="main-site-author-name">
                        Yannick Plenevaux
                    </h3>
                        <h3 class="main-site-author-description">
                                <span class="main-site-author-description-line">Microsoft 365 Solutions Architect</span>
                                <span class="main-site-author-description-line">Office Development MVP</span>
                        </h3>
            </div>

        <div class="menu-social-links">
            <p class="social-links">

    <a href="https://mvp.microsoft.com/en-us/PublicProfile/5003599?fullName=Yannick%20Plenevaux" target="_blank"
        title="Microsoft MVP" rel="noopener">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50">
            <defs>
                <style>
                    .a {
                        fill: currentColor;
                    }

                    .b {
                        fill: #1d1d1d;
                    }
                </style>
            </defs>
            <rect class="a" width="50" height="50"></rect>
            <path class="b"
                d="M17.42,26.16a15.14,15.14,0,0,0-.22,1.59l-.07.48h0a14.16,14.16,0,0,0-.33-2l-1.82-7.89h-3.5v13h2.07V24.43c0-1.18,0-2.39-.09-3.61h.08l.35,2.3,2,8.19h2.28L20,23c.18-.9.31-1.63.39-2.18h.05q-.09,2-.09,2.94v7.55h2.14v-13H19.13Zm18.36.72h1a3.81,3.81,0,0,0,3-1.24,4.54,4.54,0,0,0,1.14-3.17,4.23,4.23,0,0,0-1-3.08A3.81,3.81,0,0,0,37,18.34H33.29v13h2.49Zm0-6.37h.83a1.62,1.62,0,0,1,1.25.52,2.25,2.25,0,0,1,.48,1.57c0,1.42-.57,2.13-1.7,2.13h-.86Zm-9.24,10.8h2.67l3.31-13H30l-1.8,8.5c-.09.47-.15.92-.19,1.34l-.05.35h-.06a12,12,0,0,0-.2-1.65l-1.8-8.54H23.32ZM25.26,46.75,3.75,25.24,25.24,3.75,46.75,25.26Z"
                transform="translate(-0.25 -0.25)"></path>
        </svg>
        </a>

    <a href="https://twitter.com/yp_code" target="_blank" title="Twitter" rel="noopener">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
            <path
                d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z">
            </path>
        </svg>
    </a>

    <a href="https://github.com/ypcode" target="_blank" title="GitHub" rel="noopener">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512">
            <path
                d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z">
            </path>
        </svg>
    </a>

    <a href="https://www.linkedin.com/in/yannickplenevaux" target="_blank" title="LinkedIn" rel="noopener">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
            <path
                d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z">
            </path>
        </svg>
    </a>


</p>
        </div>
    </div>
   
    <div class="site-content">
        <main role="main" class="pb-3">
            <div class="content-item post">
    
    <div class="content-item-title">
        <span class="post-publishing-date">Jul 28, 2017</span>
        <h1>
            Handle separation of concerns (SoC) properly with the SharePoint Framework
            <hr/>
        </h1>
    </div>

        <div class="content-item-featured-image-container">
            <img class="content-item-featured-image" src="https://ypcode.github.io/images/code.jpg" alt="code image" />
        </div>
   
    <div class="content">
        <p>Hi SharePoint Devs, In this post, I would like to tackle a notion very important to me as a code lover: the Separation of Concerns (SoC) and how we can implement this principle in a SharePoint Framework solution. For the example, we will re-use the Kanban SPFx WebPart I presented in this <a href="https://ypcode.wordpress.com/2017/07/13/implement-engaging-webpart-with-the-sharepoint-framework-and-jquery-ui/">post</a>. If you want to follow the steps of this article and do the changes by yourself, you can download or clone the github repo for this webpart <a href="https://github.com/ypcode/spfx-kanban/tree/master">here</a></p>
<h2 id="what-is-soc">What is SoC ?</h2>
<p><img src="/images/2017/07/soc.png" alt="SoC" />SoC is a principle where the code is splitted into units each responsible for its own business (UI, Business, Data Access, ...), the units (or layers) encapsulate their internal business data and produce a result according to the input we pass to them. The units don't care about what's internal in other units, they only care about the result they get when they use the features of other units. Each unit is easier to maintain, to unit-test, and even entirely rewritten if needed. An application is then a set of units that communicate with each other. We remove all intricate dependencies we have to deal with when the concerns are not really separated (calls to data API directly in the UI code, changes to do in the UI whenever the data schema changes,  ...) Moreover, if you build your classes and services generic enough, you will be able to take it as they are to reuse in a totally different context.</p>
<h3 id="in-practice">In practice</h3>
<p>In practice, it means we need to design and implement our units of code in a way that they will never depend on a actual implementation of any unit, because it means it would be very difficult to maintain or change in the future. Instead, units will only be aware of interfaces they have to deal with, they should never have a clue of what's going on internally in the units they consume. It is, actually, one of the pillars of OOP. From this point, I will talk about these units as <strong>Services</strong>. A service is nothing more than a unit of code dedicated to a specific concern, it is generally described by a public interface. So, to achieve that, in practice, we have to define public interfaces that will be known by any consumer of the services</p>
<h3 id="a-configurationservice-class">A ConfigurationService class</h3>
<p>We want to remove all dependencies to the WebPart in our services. However,  the WebPart class handles something very important: the configuration via the Property Pane. Under a <strong>src/services/</strong> folder, let's create a class that will hold the configuration information. Let's also create its public interface: <code>\nimport { ServiceKey} from &quot;@microsoft/sp-core-library&quot;;  /**  * The Configuration Service public interface  */ export interface IConfigurationService {    tasksListId: string;    statusFieldInternalName: string; }  /**  * The default implementation of the Configuration service class  * It is a simple class with 2 public properties that represent the settings in the property pane  */ export default class ConfigurationService implements IConfigurationService {     public tasksListId: string;     public statusFieldInternalName: string; }  export const ConfigurationServiceKey = ServiceKey.create&lt;IConfigurationService&gt;(&quot;kanban:config&quot;, ConfigurationService);\n</code> You don't have to worry about the ServiceKey things for now. We have now to relay the configuration information  from the property pane to this service class. In the KanbanBoardWebPart class, add the following changes <a href="https://gist.github.com/ypcode/971f9293603e11bddd042112a054ff2b">https://gist.github.com/ypcode/971f9293603e11bddd042112a054ff2b</a></p>
<h3 id="a-dataservice-class">A DataService class</h3>
<p>In order to clearly separate the concerns, we have to move all the methods responsible for the data access from the WebPart UI class to a dedicated service class. In the <strong>src/services/</strong> folder let's add a <strong>DataService.ts</strong> file. We then move all the data related methods from the UI to that service. We also declare the public interface of the service. <code>\n import { ServiceScope, ServiceKey } from &quot;@microsoft/sp-core-library&quot;; import { firstOrDefault } from &quot;../helpers/CollectionHelper&quot;; import { IFieldInfo, IListInfo, ITask } from &quot;../models&quot;; import { IConfigurationService, ConfigurationServiceKey } from &quot;./ConfigurationService&quot;;  import pnp from &quot;sp-pnp-js&quot;;  export const ChoiceFieldType = &quot;Choice&quot;;  export interface IDataService {     /**      *  Get the statuses (the available choices) from the specified choice field      */     getStatuses(): Promise&lt;string[]&gt;;      /**      * Get the available lists in the current web      */     getAvailableLists(refresh?: boolean): Promise&lt;IListInfo[]&gt;;      /**      * Get the available choice fields for the specified list      */     getAvailableChoiceFields(): Promise&lt;IFieldInfo[]&gt;;      /**      * Get the available choice fields from lists aleady loaded      */     getAvailableChoiceFieldsFromLoadedLists(): IFieldInfo[];      /**      * Get all tasks      */     getAllTasks(): Promise&lt;ITask[]&gt;;      /**      * Update the status to newStatus for the specified task      */     updateTaskStatus(taskId: number, newStatus: string): Promise&lt;void&gt;; }   export default class SharePointDataService implements IDataService {      private config: IConfigurationService = null;     private cachedAvailableLists: IListInfo[] = null;      constructor(serviceScope: ServiceScope) {         serviceScope.whenFinished(() =&gt; {             // Configure the required dependencies             this.config = serviceScope.consume(ConfigurationServiceKey);         });      }      public getStatuses(): Promise&lt;string[]&gt; {         return pnp.sp.web.lists.getById(this.config.tasksListId).fields             .getByInternalNameOrTitle(this.config.statusFieldInternalName)             .get()             .then((fieldInfo: IFieldInfo) =&gt; fieldInfo.Choices || []);     }      public getAvailableLists(refresh: boolean = false): Promise&lt;IListInfo[]&gt; {         if (!refresh &amp;&amp; this.cachedAvailableLists)             return new Promise&lt;IListInfo[]&gt;(resolve =&gt; resolve(this.cachedAvailableLists));          return pnp.sp.web.lists             .expand(&quot;Fields&quot;)             .select(&quot;Id&quot;, &quot;Title&quot;, &quot;Fields/Title&quot;, &quot;Fields/InternalName&quot;, &quot;Fields/TypeAsString&quot;)             .get()             .then(lists =&gt; {                 this.cachedAvailableLists = lists;                 return lists;             });     }      public getAvailableChoiceFields(): Promise&lt;IFieldInfo[]&gt; {         return this.getAvailableLists(false).then(lists =&gt; {             let list = firstOrDefault(lists, l =&gt; l.Id == this.config.tasksListId);             if (!list)                 return [];              return list.Fields.filter(f =&gt; f.TypeAsString == ChoiceFieldType);         });     }      public getAvailableChoiceFieldsFromLoadedLists() {         if (!this.cachedAvailableLists)             return [];          let list = firstOrDefault(this.cachedAvailableLists, l =&gt; l.Id == this.config.tasksListId);         if (!list)             return [];          return list.Fields.filter(f =&gt; f.TypeAsString == ChoiceFieldType);     }       public updateTaskStatus(taskId: number, newStatus: string): Promise&lt;any&gt; {         // Set the value for the configured &quot;status&quot; field         let fieldsToUpdate = {};         fieldsToUpdate[this.config.statusFieldInternalName] = newStatus;          // Update the property on the list item         return pnp.sp.web.lists.getById(this.config.tasksListId).items.getById(taskId).update(fieldsToUpdate);     }      public getAllTasks(): Promise&lt;ITask[]&gt; {         return pnp.sp.web.lists.getById(this.config.tasksListId).items             .select(&quot;Id&quot;, &quot;Title&quot;, this.config.statusFieldInternalName)             .get()             .then((results: ITask[]) =&gt; results &amp;&amp; results.map(t =&gt; ({                 Id: t.Id,                 Title: t.Title,                 Status: t[this.config.statusFieldInternalName]             })));     } }  export const DataServiceKey = ServiceKey.create&lt;IDataService&gt;(&quot;kanban:data-service&quot;, SharePointDataService);\n</code> Again that ServiceKey and now ServiceScope, what are they ? These classes are the implementation in SPFx that allow the developer to leverage dependency injection. Instead of passing a reference to each single dependency, we pass the scope as argument to the unit and the unit calls a consume() method to get the service it needs. <em>With the line</em> <em><strong>export const DataServiceKey = ServiceKey.create<IDataService>(&quot;kanban:data-service&quot;, SharePointDataService);</strong></em> We declare the ServiceKey, the key that will identify the service within the scope Now that we implemented all the needed logic in the Service implementation, we have to adapt the WebPart class code to remove all the data accessing logic. We also need to consume the services, let's adapt the KanbanBoardWebPart class as follows : <a href="https://gist.github.com/ypcode/0ecd6fb8bef2895af897c76577ad88cc">https://gist.github.com/ypcode/0ecd6fb8bef2895af897c76577ad88cc</a> You can see now that the code of the WebPart class only contains things related to the UI. All the data fetching and updating is encapsulated within the service.</p>
<h4 id="cool-my-concerns-are-separated-i-can-maintain-it-in-a-better-way-now">Cool ! My concerns are separated, I can maintain it in a better way now !</h4>
<p>Exactly, if anything in the SharePoint data schema changes, you only have to adapt the DataService implementation, the UI will not change at all !</p>
<h4 id="but-there-is-even-better-implementation-dedicated-to-current-environment">But there is even better: Implementation dedicated to current environment.</h4>
<p>Let's take the case of Local Workbench or unit testing and the needed mock data. We create a mock implementation for the Data Service, it uses mock in-memory data, however it implements the exact same interface as the real service, that way, the UI layer will never even know whether it is in local workbench or in a real SharePoint page <code>\nimport { ServiceScope } from &quot;@microsoft/sp-core-library&quot;;  import { firstOrDefault } from &quot;../../helpers/CollectionHelper&quot;; import {     IDataService,     IConfigurationService,     ConfigurationServiceKey,     ChoiceFieldType } from &quot;../&quot;; import { IFieldInfo, IListInfo, ITask } from &quot;../../models&quot;;  const mockListsInfo: IListInfo[] = [     {         Id: &quot;##1&quot;,         Title: &quot;Tasks List 1&quot;,         Fields: [             {                 Title: &quot;Title&quot;,                 InternalName: &quot;Title&quot;,                 TypeAsString: &quot;Text&quot;             },             {                 Title: &quot;Task Status&quot;,                 InternalName: &quot;Status&quot;,                 TypeAsString: ChoiceFieldType,                 Choices: [&quot;Open&quot;, &quot;On going&quot;, &quot;Done&quot;, &quot;Canceled&quot;]             },             {                 Title: &quot;Priority&quot;,                 InternalName: &quot;Priority&quot;,                 TypeAsString: ChoiceFieldType,                 Choices: [&quot;Low&quot;, &quot;Medium&quot;, &quot;High&quot;]             }         ]     },     {         Id: &quot;##2&quot;,         Title: &quot;Tasks List 2&quot;,         Fields: [             {                 Title: &quot;Title&quot;,                 InternalName: &quot;Title&quot;,                 TypeAsString: &quot;Text&quot;             },             {                 Title: &quot;Status&quot;,                 InternalName: &quot;Status&quot;,                 TypeAsString: ChoiceFieldType,                 Choices: [&quot;New&quot;, &quot;In Progress&quot;, &quot;Completed&quot;]             }         ]     } ];  const mockTasks = {     &quot;##1&quot;: [         {             Id: 1,             Title: &quot;Task 1 from list 1&quot;,             Status: &quot;Open&quot;,             Priority: &quot;Low&quot;         },         {             Id: 2,             Title: &quot;Task 2 from list 1&quot;,             Status: &quot;On going&quot;,             Priority: &quot;Medium&quot;         },         {             Id: 3,             Title: &quot;Task 3 from list 1&quot;,             Status: &quot;On going&quot;,             Priority: &quot;Medium&quot;         },         {             Id: 4,             Title: &quot;Task 4 from list 1&quot;,             Status: &quot;Done&quot;,             Priority: &quot;High&quot;         },         {             Id: 5,             Title: &quot;Task 5 from list 1&quot;,             Status: &quot;Canceled&quot;,             Priority: &quot;Low&quot;         },     ],     &quot;##2&quot;: [         {             Id: 1,             Title: &quot;Task 1 from list 2&quot;,             Status: &quot;New&quot;         },         {             Id: 2,             Title: &quot;Task 2 from list 2&quot;,             Status: &quot;New&quot;         },         {             Id: 3,             Title: &quot;Task 3 from list 2&quot;,             Status: &quot;In Progress&quot;         },         {             Id: 4,             Title: &quot;Task 4 from list 2&quot;,             Status: &quot;Canceled&quot;         },     ] };     export class MockDataService implements IDataService {     private config: IConfigurationService = null;      constructor(serviceScope: ServiceScope) {         serviceScope.whenFinished(() =&gt; {             // Configure the required dependencies             this.config = serviceScope.consume(ConfigurationServiceKey);         });      }       public getStatuses(): Promise&lt;string[]&gt; {         return new Promise&lt;string[]&gt;((resolve) =&gt; {             let list = firstOrDefault(mockListsInfo, ld =&gt; ld.Id == this.config.tasksListId);             if (!list) {                 resolve([]);                 return;             }              let choiceField = firstOrDefault(list.Fields, f =&gt; f.InternalName == this.config.statusFieldInternalName);             resolve((choiceField &amp;&amp; choiceField.Choices) || []);         });      }      public getAvailableLists(): Promise&lt;IListInfo[]&gt; {         return new Promise&lt;IListInfo[]&gt;((resolve) =&gt; {             resolve(mockListsInfo);         });     }      public getAvailableChoiceFields(): Promise&lt;IFieldInfo[]&gt; {         return this.getAvailableLists().then(lists =&gt; {             let list = firstOrDefault(lists, l =&gt; l.Id == this.config.tasksListId);             if (!list)                 return [];              return list.Fields.filter(f =&gt; f.TypeAsString == ChoiceFieldType);         });     }      public getAvailableChoiceFieldsFromLoadedLists() {         let list = firstOrDefault(mockListsInfo, l =&gt; l.Id == this.config.tasksListId);         if (!list)             return [];          return list.Fields.filter(f =&gt; f.TypeAsString == ChoiceFieldType);     }      public updateTaskStatus(taskId: number, newStatus: string): Promise&lt;any&gt; {         return new Promise&lt;IListInfo[]&gt;((resolve) =&gt; {             let tasks: ITask[] = mockTasks[this.config.tasksListId];              // For each task of the list with the Id Task ID (Always only one!), update the status             tasks.filter(t =&gt; t.Id == taskId)                 .forEach(t =&gt; t.Status = newStatus);               resolve();         });     }      public getAllTasks(): Promise&lt;ITask[]&gt; {         return new Promise&lt;ITask[]&gt;((resolve) =&gt; {             let tasks: ITask[] = mockTasks[this.config.tasksListId]                 .map(t =&gt; ({                     Id: t.Id,                     Title: t.Title,                     Status: t[this.config.statusFieldInternalName]                 }));             resolve(tasks);         });     } }\n</code> We have now to tell the WebPart to use this implementation when it used in the local workbench or in unit testing. You might have noticed, in the <em>onInit()</em> method of the KanbanBoardWebPart class, I removed the SPFx PnP setup and I added some <em>AppStartup.configure()</em> call. What is that ? A great advantage of the SPFx <strong>ServiceScope</strong> class is that it holds the default implementation of the services. However, you are able to create child scopes that will contain specific implementation for some services, all the services that have no implementation at the child scope level will take it from its parent scope all the way up until the root ServiceScope. I have a AppStartup class that make all the required configuration and instantiate the appropriate services according to the context, all the consumers of the services will not know which implementation they use, they will just use it ! <a href="https://gist.github.com/ypcode/2b576f82eb6f5536a89226e46849e5e8">https://gist.github.com/ypcode/2b576f82eb6f5536a89226e46849e5e8</a> In my solution, the <em><strong>AppStartup</strong></em> class is the only one that knows about the current environment (Local, Test, SharePoint, ClassicSharePoint). I designed the class to be responsible of returning the appropriate scope of implementations according to the context. Take a look on the <em><strong>configureForLocalOrTestContext()</strong></em> method to check how to register specific implementation of a service for a given key. the <em><strong>configure()</strong></em> method that is called by the <em><strong>KanbanBoardWebPart</strong></em> class performs all the required startup configuration and returns the ServiceScope that will be used by all the layers of the application.</p>
<h2 id="conclusion">Conclusion</h2>
<p>With this implementation, all concerns are separated and are easier to maintain, fix, improve or replace ! The only item you have to pass to the units is the <strong>ServiceScope</strong>. I encourage you to read the following articles about the SPFx Service Scope:</p>
<ul>
<li><a href="https://dev.office.com/sharepoint/reference/spdx/sp-core-library/servicescope">https://dev.office.com/sharepoint/reference/spdx/sp-core-library/servicescope</a></li>
<li><a href="https://github.com/SharePoint/sp-dev-docs/wiki/Tech-Note:-ServiceScope-API">https://github.com/SharePoint/sp-dev-docs/wiki/Tech-Note:-ServiceScope-API</a></li>
</ul>
<p>You can see the whole solution on the <a href="https://github.com/ypcode/spfx-kanban/tree/V2">V2 branch on my github repo</a> Hope you liked this post and it will be helpful. Yannick</p>

    </div>
</div>
        </main>

        <footer class="border-top footer">
                &copy; Copyrights 2020 - YPcode - Yannick Plenevaux
        </footer>
    </div>


    <script src="/lib/jquery/dist/jquery.min.js"></script>
    <script src="/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/site.js"></script>
    <script async src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/prism.min.js" ></script>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/plugins/autolinker/prism-autolinker.js" ></script>

        <script async src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/components/prism-aspnet.js" ></script>
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/components/prism-c.js" ></script>
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/components/prism-clike.js" ></script>
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/components/prism-csharp.js" ></script>
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/components/prism-css-extras.js" ></script>
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/components/prism-scss.js" ></script>
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/components/prism-markup.min.js" ></script>
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/components/prism-javascript.min.js" ></script>
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/components/prism-json.min.js" ></script>
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/components/prism-jsx.min.js" ></script>
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/components/prism-powershell.js" ></script>
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/components/prism-typescript.min.js" ></script>
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/components/prism-bash.js" ></script>



</body>
</html>
