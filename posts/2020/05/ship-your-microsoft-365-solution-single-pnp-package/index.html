<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>YPcode</title>
    <link rel="icon" href="/images/favicon.png" type="image/png" />
    <link rel="canonical" href="https://ypcode.github.io/posts/2020/05/ship-your-microsoft-365-solution-single-pnp-package" />
    <link rel="stylesheet" href="/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="/css/site.css" />
    <meta name="generator" content="PVX WebContentGenerator" />
   
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/themes/prism.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/themes/prism.min.css">
</noscript>
<link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/themes/prism-tomorrow.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/themes/prism-tomorrow.min.css">
</noscript>
<link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/plugins/autolinker/prism-autolinker.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/plugins/autolinker/prism-autolinker.css">
</noscript>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-172372458-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-172372458-1');
</script>

<style>
.social-links {
    display: inline-flex;
    width: 60%;
    margin:auto;
    justify-content: center;
    color: #807070;
}

.social-links a {
    margin-right: 15px;
}

.social-links a:hover {
    color: #9e1e28;
}

    .social-links svg {
        fill: currentColor;
        height: 18px;
    }
</style>
        <meta property="og:site_name" content="YPcode" />
        <meta property="og:type" content="article" />
        <meta property="og:title" content="Ship your Microsoft 365 solution as a single PnP package" />
        <meta property="og:url" content="https://ypcode.github.io/posts/2020/05/ship-your-microsoft-365-solution-single-pnp-package" />
        <meta property="og:image" content="https://ypcode.github.io/images/template.xml-screenshot.png?r=202007151114" />
        <meta property="article:publisher" content="https://www.facebook.com/yannick.plenevaux" />
        <meta property="article:published_time" content="2020-05-11 06:00:54Z" />
        <meta property="article:modified_time" content="2020-05-11 06:00:54Z" />
                <meta property="article:tag" content="Microsoft 365" />
                <meta property="article:tag" content="Office 365" />
                <meta property="article:tag" content="PnP" />
                <meta property="article:tag" content="PowerShell" />
                <meta property="article:tag" content="SharePoint" />
                <meta property="article:tag" content="SharePoint Framework" />
                <meta property="article:tag" content="SharePoint Online" />
                <meta property="article:tag" content="SharePointFullPage" />
                <meta property="article:tag" content="SingleWebPartAppPage" />
                <meta property="article:tag" content="SPFx" />
                <meta property="article:tag" content="SPFx extensions" />
                <meta property="article:tag" content="Tenant" />
        <meta name="twitter:title" content="Ship your Microsoft 365 solution as a single PnP package" />
        <meta name="twitter:url" content="https://ypcode.github.io/posts/2020/05/ship-your-microsoft-365-solution-single-pnp-package" />
            <meta name="twitter:card" content="summary_large_image" />
            <meta name="twitter:image" content="https://ypcode.github.io/images/template.xml-screenshot.png?r=202007151114" />
            <meta name="twitter:label2" content="Filed under" />
            <meta name="twitter:data2" content="Microsoft 365, Office 365, PnP, PowerShell, SharePoint, SharePoint Framework, SharePoint Online, SharePointFullPage, SingleWebPartAppPage, SPFx, SPFx extensions, Tenant" />
        <meta name="twitter:site" content="@yp_code" />
    <link rel="alternate" type="application/rss+xml" title="YPcode" href="https://ypcode.github.io/feed" />


    <script>
        var initialSiteContentHeight = null;
        function toggleMenu() {
            var menu = document.querySelector(".menu");
            var siteContent = document.querySelector(".site-content");
            if (menu && siteContent) {
                if (menu.classList.contains("visible")) {
                    menu.classList.remove("visible");
                } else {
                    menu.classList.add("visible");
                }
            }
        }
    </script>
</head>
<body>
    <div class="menu">
        <span class="menu-hamburger-icon" onclick="toggleMenu();">
            <svg xmlns="http://www.w3.org/2000/svg" 
                x="0px" 
                y="0px"
                width="30" 
                height="30"
                viewBox="0 0 172 172"
                style=" fill:#000000;">
                    <g fill="none" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal"><path d="M0,172v-172h172v172z" fill="none"></path><g fill="#ffffff"><path d="M0,25.8v17.2h172v-17.2zM0,77.4v17.2h172v-17.2zM0,129v17.2h172v-17.2z"></path></g></g>
            </svg>
        </span>
        <a href="https://ypcode.github.io/">
            <h1 class="main-site-title">YPcode</h1>
            <hr class="sep main-site-title-sep"/>
            <h2 class="main-site-description">Experiences and research on Microsoft 365, Azure and modern web development</h2>
        </a>
        <nav class="navigation">
    <ul>
<li class="nav-item">
    <span class="link-icon icon-home" ></span><a class="nav-link" href="/" >Home</a>
</li><li class="nav-item">
    <span class="link-icon icon-about" ></span><a class="nav-link" href="/pages/about-me/" >About me</a>
</li><li class="nav-item">
    <span class="link-icon icon-about" ></span><a class="nav-link" href="/pages/projects-contrib/" >Projects &amp; Contributions</a>
</li>    </ul>
</nav>
        
            <div class="main-site-author">
                    <img class="main-site-author-picture" src="/images/me.png" />
                    <h3 class="main-site-author-name">
                        Yannick Plenevaux
                    </h3>
                        <h3 class="main-site-author-description">
                                <span class="main-site-author-description-line">Microsoft 365 Solutions Architect</span>
                                <span class="main-site-author-description-line">Office Development MVP</span>
                        </h3>
            </div>

        <div class="menu-social-links">
            <p class="social-links">

    <a href="https://mvp.microsoft.com/en-us/PublicProfile/5003599?fullName=Yannick%20Plenevaux" target="_blank"
        title="Microsoft MVP" rel="noopener">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50">
            <defs>
                <style>
                    .a {
                        fill: currentColor;
                    }

                    .b {
                        fill: #1d1d1d;
                    }
                </style>
            </defs>
            <rect class="a" width="50" height="50"></rect>
            <path class="b"
                d="M17.42,26.16a15.14,15.14,0,0,0-.22,1.59l-.07.48h0a14.16,14.16,0,0,0-.33-2l-1.82-7.89h-3.5v13h2.07V24.43c0-1.18,0-2.39-.09-3.61h.08l.35,2.3,2,8.19h2.28L20,23c.18-.9.31-1.63.39-2.18h.05q-.09,2-.09,2.94v7.55h2.14v-13H19.13Zm18.36.72h1a3.81,3.81,0,0,0,3-1.24,4.54,4.54,0,0,0,1.14-3.17,4.23,4.23,0,0,0-1-3.08A3.81,3.81,0,0,0,37,18.34H33.29v13h2.49Zm0-6.37h.83a1.62,1.62,0,0,1,1.25.52,2.25,2.25,0,0,1,.48,1.57c0,1.42-.57,2.13-1.7,2.13h-.86Zm-9.24,10.8h2.67l3.31-13H30l-1.8,8.5c-.09.47-.15.92-.19,1.34l-.05.35h-.06a12,12,0,0,0-.2-1.65l-1.8-8.54H23.32ZM25.26,46.75,3.75,25.24,25.24,3.75,46.75,25.26Z"
                transform="translate(-0.25 -0.25)"></path>
        </svg>
        </a>

    <a href="https://twitter.com/yp_code" target="_blank" title="Twitter" rel="noopener">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
            <path
                d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z">
            </path>
        </svg>
    </a>

    <a href="https://github.com/ypcode" target="_blank" title="GitHub" rel="noopener">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512">
            <path
                d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z">
            </path>
        </svg>
    </a>

    <a href="https://www.linkedin.com/in/yannickplenevaux" target="_blank" title="LinkedIn" rel="noopener">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
            <path
                d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z">
            </path>
        </svg>
    </a>


</p>
        </div>
    </div>
   
    <div class="site-content">
        <main role="main" class="pb-3">
            <div class="content-item post">
    
    <div class="content-item-title">
        <span class="post-publishing-date">May 11, 2020</span>
        <h1>
            Ship your Microsoft 365 solution as a single PnP package
            <hr/>
        </h1>
    </div>

        <div class="content-item-featured-image-container">
            <img class="content-item-featured-image" src="https://ypcode.github.io/images/template.xml-screenshot.png?r=202007151114" alt="code image" />
        </div>
   
    <div class="content">
        <p>Hi Microsoft 365 devs,
In this blog post, I will show you how easy it is, thanks to the PnP provisioning engine, to ship a solution as a single package.
All the dependencies (at least most of them for now) can be included in that package and thus significantly reduce the needs for a complex multi-steps setup procedure tackling several different administration areas across Azure, Office 365, on the site level and so on.</p>
<h2 id="some-context">Some context</h2>
<p>Recently I have been working on a complete rework of my side project <a href="https://github.com/pnp/sp-site-designs-studio">Site Designs Studio V2</a>. It is a rewrite of the application that was originally a single WebPart. It is no longer the case, it is now a standalone modern application and I wanted to include some features that need some consistency and make some assumptions on the context in which the application is executed. Concretely, it means that it is installed as a dedicated site collection (a modern communication site) with its home page being the SPFx app part page. It relies on some dedicated document libraries (only one currently to store the site designs preview images). To be as consistent as possible, I wanted the application not to be available as a WebPart or an app part page on any other site. It means I have to hide it from toolbox and deploy it programmatically on a modern page which I change the layout. Moreover to be able to grant and revoke permissions through the Site Designs REST API in a user friendly way, I needed to implement a custom people picker that needs a Microsoft Graph permission. If you follow me it means that... to install the application we need the following steps:</p>
<ol>
<li>Create a modern communication site</li>
<li>Create a library in it to store site designs preview images.</li>
<li>Upload and deploy the SPFx application in the app catalog</li>
<li>Approve the Microsoft Graph permission</li>
<li>Add the page programmatically to the new site</li>
<li>Add the instance of the application to the page</li>
<li>Change the layout of the page</li>
</ol>
<p>Well... that can easily be done from a PnP PowerShell or Office 365 CLI script. But it means some code to maintain and a set of files that need to be shipped altogether. Moreover, it means extra overhead to handle &quot;partial&quot; setup or update matters !</p>
<h2 id="an-application-package">An application package</h2>
<p>In the good old days of Farm Trusted solutions (hmmm... no :D), we used to basically have 1 single package to ship (in most scenarios) that could have all needed assets included with the DLLs, various assets and artifacts XML definitions using the Feature Framework. It's no longer the case with SharePoint Online*, we have now SPFx packages (.sppkg) that can contain the JS code and some assets but not much more. * to be accurate, declarative XML for SharePoint artifacts are still supported even in SPFx packages. I avoid that as much as possible because it's quite limited and still have the good old limitations of Feature Framework (Try to update artifacts, you'll realize :D) So WSPs had some con's and used to bring annoying challenges, but still, I liked the concept of one single distributable package.</p>
<h2 id="a-bit-of-history">A bit of History...</h2>
<p>For the past 4-5 years, the PnP initiative has built an open-source and community driven software called the PnP provisioning engine that allow to provision basically EVERYTHING in SharePoint using a declarative template formatted as XML (JSON is also supported, but I think I never seen any template in JSON so far :D), from a conceptual perspective, it looks pretty similar to what we were used to back then with WSPs and definitions XML and CAML and all. From a technical perspective, however, it is totally different because it uses remote APIs. It means 2 things :</p>
<ol>
<li>It is available for SharePoint On Prem and SharePoint Online</li>
<li>The engine basically does, programmatically, what we can do manually from the user interface. it blows up the need of complex base templates and dependencies on the target site</li>
</ol>
<p>For many years, the PnP provisioning engine allows you to create a definition of all the changes you want to apply to a SharePoint site collection. Moreover, you can update and reapply the same template to the same target and it will apply, on its own, only the latest changes (with some exceptions...). You can extract (and then apply) templates with the PnP engine as XML ! It's an awesome capability to import and export sites, it can even be used for data migration with a bit &quot;extra&quot; work. Wait... there's even better ! if you specify the output to have a &quot;.pnp&quot; file extension, it will actually extract the definition and all referenced assets in a ZIP archive (an OpenXml format file to be exact). The engine is actually implemented in the <a href="https://github.com/pnp/PnP-Sites-Core">PnP Core library,</a> it means you can use it directly in your own .NET application. It is also wrapped in the <a href="https://docs.microsoft.com/en-us/powershell/sharepoint/sharepoint-pnp/sharepoint-pnp-cmdlets?view=sharepoint-ps">PnP PowerShell commands set</a> meaning you can simply install those cmdlets and leverage all the power of the engine.</p>
<h2 id="a-tenant-wide-package">A tenant-wide package</h2>
<p>Since 2018 (I can't remember exactly when it was realeased), the PnP engine not only supports site collection templates, but also templates that can be used against the whole tenant in SharePoint Online Microsoft 365. That's right, you can now, with a single template, provision entire site collections, and apply template to each of them ! The <a href="https://github.com/pnp/PnP-Provisioning-Schema/blob/master/ProvisioningSchema-2020-02.md">schema</a> is actually already written in a way that it (or will) supports many of the software across Microsoft 365 (SharePoint, Teams, OneDrive, Azure AD). We have to take care that, to apply such tenant, the current credentials must have the sufficient privileges on the tenant (e.g. SharePoint global administrator).</p>
<h2 id="my-solution-distributable-package">My solution distributable package</h2>
<p>PnP tenant template allowed me to basically write declaratively all the steps of my setup procedure in a single XML file. You can have <a href="https://github.com/pnp/sp-site-designs-studio/blob/master/setup/PnPPowershell/debug/sdsv2-template.xml">a look at the entire file here</a>. Let's see each of the steps in the PnP declarative way</p>
<ol>
<li>Create a modern communication site</li>
</ol>
<pre><code class="language-xml">  &lt;pnp:Sequence ID=&quot;MAIN-SEQUENCE&quot;&gt;
        &lt;pnp:SiteCollections&gt;
            &lt;pnp:SiteCollection xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:type=&quot;pnp:CommunicationSite&quot; ProvisioningId=&quot;SDSV2.SITE&quot; Url=&quot;https://{parameter:TenantName}.sharepoint.com/sites/{parameter:SitePath}&quot; Title=&quot;Site Designs Studio&quot; Owner=&quot;{currentuserloginname}&quot; Description=&quot;{parameter:Description}&quot; Language=&quot;{parameter:lcid}&quot;&gt;
                &lt;pnp:Templates&gt;
                    &lt;pnp:ProvisioningTemplateReference ID=&quot;SITE-DESIGNS-STUDIO-V2-APP&quot;/&gt;
                &lt;/pnp:Templates&gt;
            &lt;/pnp:SiteCollection&gt;
        &lt;/pnp:SiteCollections&gt;
    &lt;/pnp:Sequence&gt;
</code></pre>
<ol start="2">
<li>Create a library in it to store site designs preview images.</li>
</ol>
<pre><code class="language-xml">  &lt;pnp:Lists&gt;
      &lt;pnp:ListInstance Title=&quot;Site Design - Preview Images&quot; Description=&quot;A library to store the Site Designs preview images&quot; DocumentTemplate=&quot;{site}/SiteDesignPreviewImages/Forms/template.dotx&quot; TemplateType=&quot;101&quot; Url=&quot;SiteDesignPreviewImages&quot; EnableVersioning=&quot;true&quot; MinorVersionLimit=&quot;0&quot; MaxVersionLimit=&quot;500&quot; DraftVersionVisibility=&quot;0&quot; TemplateFeatureID=&quot;00bfea71-e717-4e80-aa17-d0c71b360101&quot; EnableAttachments=&quot;false&quot; DefaultDisplayFormUrl=&quot;{site}/SiteDesignPreviewImages/Forms/DispForm.aspx&quot; DefaultEditFormUrl=&quot;{site}/SiteDesignPreviewImages/Forms/EditForm.aspx&quot; DefaultNewFormUrl=&quot;{site}/SiteDesignPreviewImages/Forms/Upload.aspx&quot; ImageUrl=&quot;/_layouts/15/images/itdl.png?rev=47&quot; IrmExpire=&quot;false&quot; IrmReject=&quot;false&quot; IsApplicationList=&quot;false&quot; ValidationFormula=&quot;&quot; ValidationMessage=&quot;&quot;&gt;
      &lt;!-- content removed for brevity --&gt;
          &lt;pnp:Security&gt;
              &lt;pnp:BreakRoleInheritance CopyRoleAssignments=&quot;false&quot; ClearSubscopes=&quot;false&quot;&gt;
                  &lt;pnp:RoleAssignment Principal=&quot;{associatedmembergroupid}&quot; RoleDefinition=&quot;Contribute&quot;/&gt;
                  &lt;pnp:RoleAssignment Principal=&quot;c:0-.f|rolemanager|spo-grid-all-users/{parameter:TenantId}&quot; RoleDefinition=&quot;Read&quot;/&gt;
              &lt;/pnp:BreakRoleInheritance&gt;
          &lt;/pnp:Security&gt;
      &lt;/pnp:ListInstance&gt;
    &lt;/pnp:Lists&gt;
</code></pre>
<ol start="3">
<li>Upload and deploy the SPFx application in the app catalog (Note the Src attribute of the &lt;pnp:Package element, it refers to a relative path on the current file system!)</li>
</ol>
<pre><code class="language-xml">  &lt;pnp:Tenant&gt;
    &lt;pnp:AppCatalog&gt;
        &lt;pnp:Package Src=&quot;package\site-designs-studio-v2.sppkg&quot; Action=&quot;UploadAndPublish&quot; SkipFeatureDeployment=&quot;true&quot; Overwrite=&quot;true&quot;/&gt;
    &lt;/pnp:AppCatalog&gt;
  &lt;/pnp:Tenant&gt;
</code></pre>
<ol start="4">
<li>Approve the Microsoft Graph permission</li>
</ol>
<pre><code class="language-xml">  &lt;pnp:Tenant&gt;
    &lt;pnp:WebApiPermissions&gt;
        &lt;pnp:WebApiPermission Resource=&quot;Microsoft.Graph&quot; Scope=&quot;Directory.AccessAsUser.All&quot;/&gt;
    &lt;/pnp:WebApiPermissions&gt;
  &lt;/pnp:Tenant&gt;
</code></pre>
<ol start="5">
<li>Add the page programmatically to the new site</li>
<li>Add the instance of the application to the page</li>
<li>Change the layout of the page</li>
</ol>
<pre><code class="language-xml">&lt;pnp:ClientSidePages&gt;
      &lt;pnp:ClientSidePage PromoteAsNewsArticle=&quot;false&quot; PromoteAsTemplate=&quot;false&quot; Overwrite=&quot;true&quot; Layout=&quot;SingleWebPartAppPage&quot; Title=&quot;Site Design Studio&quot; ThumbnailUrl=&quot;&quot; PageName=&quot;sds2.aspx&quot;&gt;
        &lt;pnp:Header Type=&quot;Default&quot; LayoutType=&quot;FullWidthImage&quot; TextAlignment=&quot;Center&quot; ShowTopicHeader=&quot;false&quot; ShowPublishDate=&quot;false&quot; TopicHeader=&quot;&quot; AlternativeText=&quot;&quot; Authors=&quot;&quot; AuthorByLineId=&quot;-1&quot;/&gt;
        &lt;pnp:Sections&gt;
            &lt;pnp:Section Order=&quot;1&quot; Type=&quot;OneColumn&quot;&gt;
                &lt;pnp:Controls&gt;
                    &lt;pnp:CanvasControl WebPartType=&quot;Custom&quot; JsonControlData=&quot;{&amp;quot;id&amp;quot;: &amp;quot;e164cc97-dcae-4a4e-a899-67ebb916207e&amp;quot;, &amp;quot;instanceId&amp;quot;: &amp;quot;c2a07e0a-2080-4912-a065-e957377cbc3b&amp;quot;, &amp;quot;title&amp;quot;: &amp;quot;Site Designs Studio&amp;quot;, &amp;quot;description&amp;quot;: &amp;quot;The Site Designs Studio allows SharePoint power users to manage, create and edit Site Designs and Site Scripts&amp;quot;, &amp;quot;dataVersion&amp;quot;: &amp;quot;2.0&amp;quot;, &amp;quot;properties&amp;quot;: {&amp;quot;description&amp;quot;:&amp;quot;Site Designs Studio&amp;quot;}, &amp;quot;serverProcessedContent&amp;quot;: {&amp;quot;htmlStrings&amp;quot;:{},&amp;quot;searchablePlainTexts&amp;quot;:{},&amp;quot;imageSources&amp;quot;:{},&amp;quot;links&amp;quot;:{}}, &amp;quot;dynamicDataPaths&amp;quot;: {}, &amp;quot;dynamicDataValues&amp;quot;: {}}&quot; ControlId=&quot;e164cc97-dcae-4a4e-a899-67ebb916207e&quot; Order=&quot;1&quot;/&gt;
                &lt;/pnp:Controls&gt;
            &lt;/pnp:Section&gt;
        &lt;/pnp:Sections&gt;
    &lt;/pnp:ClientSidePage&gt;
&lt;/pnp:ClientSidePages&gt;
</code></pre>
<p>Note the <strong>Layout</strong> attribute of the <strong>ClientSidePage</strong>, the <strong>ControlId</strong> of the <strong>CanvasControl</strong></p>
<p>Okay ! I have all my customizations declared ! But I have only an XML file so far, the SPFx package is still a separate file!
I want a <strong>single distributable package file</strong>. Let's create one !
With the PnP cmdlets, I can easily do that ! First of all I need to load the template in memory with the following command</p>
<pre><code class="language-powershell"># Make sure all relative paths mentioned in the XML are valid related to the location of the XML file
$pnpTemplate = Read-PnPTenantTemplate -Path myTemplate.xml
# If the XML is invalid, you will have an error here
# Read-PnPTenantTemplate : The element 'AppCatalog' in namespace 'http://schemas.dev.office.com/PnP/2020/02/ProvisioningSchema' cannot contain text. List of possible 
# elements expected: 'Package' in namespace 'http://schemas.dev.office.com/PnP/2020/02/ProvisioningSchema'.
# At line:1 char:16
# + $pnpTemplate = Read-PnPTenantTemplate -Path myTemplate.xml
# +                ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#     + CategoryInfo          : SyntaxError: (:) [Read-PnPTenantTemplate], XmlSchemaValidationException
#     + FullyQualifiedErrorId : TEMPLATENOTVALID,SharePointPnP.PowerShell.Commands.Provisioning.Tenant.ReadTenantTemplate
# If the XML is valid, the $pnpTemplate contain the template object
###################################################################
# $pnpTemplate
# Parameters           : {[TenantName, contoso], [SitePath, SiteDesignsStudio], [lcid, 1033], [TenantId, ]}
# Localizations        : {}
# Tenant               : OfficeDevPnP.Core.Framework.Provisioning.Model.ProvisioningTenant
# Version              : 0
# Author               : Yannick Plenevaux
# Generator            : Manual
# Description          : A Tenant template to install Site Designs Studio V2 solution
# DisplayName          : Site Designs Studio V2
# ImagePreviewUrl      :
# Connector            : OfficeDevPnP.Core.Framework.Provisioning.Connectors.FileSystemConnector
# Templates            : {SITE-DESIGNS-STUDIO-V2-APP}
# Sequences            : {MAIN-SEQUENCE}
# Teams                : OfficeDevPnP.Core.Framework.Provisioning.Model.Teams.ProvisioningTeams
# AzureActiveDirectory : OfficeDevPnP.Core.Framework.Provisioning.Model.AzureActiveDirectory.ProvisioningAzureActiveDirectory
# Drive                : OfficeDevPnP.Core.Framework.Provisioning.Model.Drive.Drive
# ProvisioningWebhooks : {}

Save-PnPTenantTemplate -Template $pnpTemplate -Out myPackage.pnp
</code></pre>
<p>After executing this script, the <strong>myPackage.pnp</strong> is generated, (if you change its extension to .zip, you will be able to explore it easily, and realize it contains indeed our template XML file as well as our <code>.sppkg file</code>.</p>
<p>That's it ! <strong>We have now a standalone distributable package to deploy solutions to Microsoft 365 and SharePoint Online !</strong>
To apply the tenant template package to your tenant, use the simple commands below</p>
<pre><code class="language-powershell"># Connect to your tenant if not already done
Connect-PnPOnline https://contoso.sharepoint.com
Apply-PnPTenantTemplate -Path .\myTemplate.pnp 
</code></pre>
<p>You might want to ship along with the .pnp file the commands above in a PowerShell script file with some relevant default parameters, but it is not at all a requirement !</p>
<p>I hope you found this post interesting, feel free to reach out with some feedback or questions !</p>
<p>Cheers !
Yannick</p>

    </div>
</div>
        </main>

        <footer class="border-top footer">
                &copy; Copyrights 2020 - YPcode - Yannick Plenevaux
        </footer>
    </div>


    <script src="/lib/jquery/dist/jquery.min.js"></script>
    <script src="/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/site.js"></script>
    <script async src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/prism.min.js" ></script>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/plugins/autolinker/prism-autolinker.js" ></script>

        <script async src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/components/prism-aspnet.js" ></script>
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/components/prism-c.js" ></script>
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/components/prism-clike.js" ></script>
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/components/prism-csharp.js" ></script>
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/components/prism-css-extras.js" ></script>
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/components/prism-scss.js" ></script>
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/components/prism-markup.min.js" ></script>
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/components/prism-javascript.min.js" ></script>
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/components/prism-json.min.js" ></script>
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/components/prism-jsx.min.js" ></script>
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/components/prism-powershell.js" ></script>
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/components/prism-typescript.min.js" ></script>
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/components/prism-bash.js" ></script>



</body>
</html>
